<html  ng-app="genericD3Module">
	<head>
		<meta charset="utf-8">
		
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<script src="https://code.jquery.com/jquery-2.2.0.js"></script>
		<script src="js/basics.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.16/d3.js"></script>
		
		


		<script src="js/angular.min.js"></script>
		<!--<script src="http://ajax.googleapis.com/ajax/libs/angularjs/1.5.0-rc.2/angular.min.js"></script>-->
		<!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.14/d3.js"></script> -->
		<script src="https://d3js.org/d3.v4.min.js"></script>


		<link rel="stylesheet" href="https://rawgit.com/novus/nvd3/v1.8.1/build/nv.d3.min.css"/>
		<script src="https://rawgit.com/novus/nvd3/v1.8.1/build/nv.d3.min.js"></script>
		<script src="https://rawgit.com/krispo/angular-nvd3/v1.0.0-rc.2/dist/angular-nvd3.js"></script>
		<!--<script src="js/nv.d3.min.js"></script>
      	<script src="js/angular-nvd3.min.js"></script>-->
      	<script src="table/js/customTable.js" type="text/javascript"></script>
	    <!-- <link rel="stylesheet" type="text/css" href="table/styles/newcss.css"> -->
	    <script src="js/genericD3Module.js"></script>
	    <link rel="stylesheet" type="text/css" href="css/style.css">


	 
		


	      <!--script src="http://ajax.googleapis.com/ajax/libs/angularjs/1.5.0-rc.2/angular-resource.min.js"></script>
	      <script src="http://ajax.googleapis.com/ajax/libs/angularjs/1.5.0-rc.2/angular-route.min.js"></script>
	      <script src="http://ajax.googleapis.com/ajax/libs/angularjs/1.5.0-rc.2/angular-cookies.min.js"></script>
	      <script src="http://ajax.googleapis.com/ajax/libs/angularjs/1.5.0-rc.2/angular-sanitize.min.js"></script>
	      <script src="http://ajax.googleapis.com/ajax/libs/angularjs/1.5.0-rc.2/angular-touch.min.js"></script>
	      <script src="http://ajax.googleapis.com/ajax/libs/angularjs/1.5.0-rc.2/angular-animate.min.js"></script-->





	    <script src="js/version.js"></script>
	    <!-- <script src="js/sonar.js"></script> -->
		<script type="text/javascript">
			var queue = [];

			var hash = window.location.hash;
			var project_id = hash.substring(hash.indexOf("=") + 1, hash.length);
			project_id = 1;


			var baseEnvironment = "ukiccprod";
			// var baseEnvironment = "KLESFTPDEV01";



			



			$(document).ready(function() {

				$(window).on('hashchange',function(){ 

					window.location.reload();
				});

				// versionChart("#element14");


			});

			function graph() {
				
				var lineData = [{
  x: 10,
  y: 20
}, {
  x: 20,
  y: 40
}, {
  x: 30,
  y: 20
}, {
  x: 50,
  y: 40
}, {
  x: 60,
  y: 20
}, {
  x: 70,
  y: 40
}
];
				var vis = d3.select('#subway'),
    WIDTH = 400,
    HEIGHT = 150,
    MARGINS = {
      top: 20,
      right: 20,
      bottom: 20,
      left: 50
    },
    xRange = d3.scale.linear().range([MARGINS.left, WIDTH - MARGINS.right]).domain([d3.min(lineData, function(d) {
      return d.x;
    }), d3.max(lineData, function(d) {
      return d.x;
    })]),
    yRange = d3.scale.linear().range([HEIGHT - MARGINS.top, MARGINS.bottom]).domain([d3.min(lineData, function(d) {
      return d.y;
    }), d3.max(lineData, function(d) {
      return d.y;
    })]),
    xAxis = d3.svg.axis()
      .scale(xRange)
      .tickSize(5)
      .tickSubdivide(true),
    yAxis = d3.svg.axis()
      .scale(yRange)
      .tickSize(5)
      .orient('left')
      .tickSubdivide(true);

/*vis.append('svg:g')
  .attr('class', 'x axis')
  .attr('transform', 'translate(0,' + (HEIGHT - MARGINS.bottom) + ')')
  .call(xAxis);

vis.append('svg:g')
  .attr('class', 'y axis')
  .attr('transform', 'translate(' + (MARGINS.left) + ',0)')
  .call(yAxis);*/


  var lineFunc = d3.svg.line()
  .x(function(d) {
    return xRange(d.x);
  })
  .y(function(d) {
    return yRange(d.y);
  })
  .interpolate('linear');

  vis.append('svg:path')
  .attr('d', lineFunc(lineData))
  .attr('stroke', 'blue')
  .attr('stroke-width', 2)
  .attr('fill', 'none');
			}
			
		</script>
		<!-- <script src="js/promoted_deployed_tabs.js"></script> -->
		<!--<script src="js/sprint_issues_count.js"></script>-->
		<!--<script src="js/sprint_issues_in_progress.js"></script>-->
		<!-- <script src="js/promoted.js"></script> -->
		<!--<script src="js/deployed.js"></script>-->
		<!-- <script src="js/monitoring_status.js"></script> -->
		<!--<script src="js/svn_summary.js"></script>-->
		<script src="js/environments.js"></script>
		<!--<script src="js/builds_deployments.js"></script>-->
		<!-- <script src="js/latest_builds.js"></script> -->


	</head>

	<body>
		<div id="wrapper">
		
		  <div id="element1" class="two-col two-row" ng-controller="singleDataController" json-Source="jira/sprint/details/1">
			<div class="head_label">
				<h2>PNG - TEST1</h2>
			</div>

			<div style="width: 100%; height: 65%;">
				<svg id="svg1" preserveAspectRatio="xMidYMid meet" viewBox="0 0 860 640"  style="background-color: #2f2f2f; width: 100%; height: 100%; display: block;"/>
			</div>

			<div style="height: 30%; width: 100%;">
		  		<div class="head_label">
		  			<h2>Recent Deployments</h2>
		  		</div>
			  	<div ng-controller="tableController" 
			  			col="['status', 'date','environment', 'service', 'duration', 'jirakey', 'rc']" 
			  			label-Headers="['Status','Date','Environment', 'Service', 'Time', 'Key', 'RC']" 
			  			json-Source="jenkins/deploy/11/14"
			  			limit="5"
			  			filter-Fields="
			  			{
					  		'filter':
					  			[{	'name': 'Environment',
					  				'value': 'DEV'}]}"
			  			>

					  	<cqm-Table datasource="data" 
					  			row-Status="['Status', 'success','failure']" 
					  			col-Status="['Status','success','failure']" 
					  			sort-Reverse="true" 
					  			sort-By="sortBy"
					  			sort-By-Header="'Date'"
					  			hide-Headers="true" 
					  			bottom-Headers="false" 
					  			id="deployed"
					  			show-Scroll-Bars="false"

					  			>
					  	</cqm-Table>

				</div>
			</div>
			

		  </div>

		  	

			
		  <div id="element2"  class="two-col one-row">
		  	<div class="head_label">
				<h2>PNG - TEST2</h2>
			</div>

			<div style="width: 100%; height: 65%;">
				<svg id="svg2" preserveAspectRatio="xMidYMid meet" viewBox="0 0 860 640"  style="background-color: #2f2f2f; width: 100%; height: 100%; display: block;"/>
			</div>


			<div style="height: 30%; width: 100%;">
		  		<div class="head_label">
		  			<h2>Recent Deployments</h2>
		  		</div>
			  	<div ng-controller="tableController" 
			  			col="['status', 'date','environment', 'service', 'duration', 'jirakey']" 
			  			label-Headers="['Status','Date','Environment', 'Service', 'Time', 'Key']" 
			  			json-Source="jenkins/deploy/11/14"
			  			limit="5"
			  			filter-Fields="
			  			{
					  		'filter':
					  			[{	'name': 'Environment',
					  				'value': 'TEST'}]}"
			  			>

					  	<cqm-Table datasource="data" 
					  			row-Status="['Status', 'success','failure']" 
					  			col-Status="['Status','success','failure']" 
					  			sort-Reverse="true" 
					  			sort-By="sortBy"
					  			sort-By-Header="'Date'"
					  			hide-Headers="true" 
					  			bottom-Headers="false" 
					  			id="deployed"
					  			show-ScrollBars="false"


					  			>
					  	</cqm-Table>

				</div>
			</div>
	
		  </div>


		  <div id="element3"  class="three-col two-row" ng-controller="controllerDownload">

		  	<div class="head_label">
				<h2>PNG - STAGE</h2>
			</div>

			<div style="width: 100%; height: 65%;">
				<svg id="svg3" preserveAspectRatio="xMidYMid meet" viewBox="0 0 860 640"  style="background-color: #2f2f2f; width: 100%; height: 100%; display: block;"/>
			</div>

			


		  	<div style="height: 30%; width: 100%;">
		  		<div class="head_label">
		  			<h2>Recent Deployments</h2>
		  		</div>
			  	<div ng-controller="tableController" 
			  			col="['status', 'date','environment', 'service', 'duration', 'jirakey']" 
			  			label-Headers="['Status','Date','Environment', 'Service', 'Time', 'Key']" 
			  			json-Source="jenkins/deploy/11/14"
			  			limit="5"
			  			filter-Fields="
			  			{
					  		'filter':
					  			[{	'name': 'Environment',
					  				'value': 'STAGE'}]}"
			  			>

					  	<cqm-Table datasource="data" 
					  			row-Status="['Status', 'success','failure']" 
					  			col-Status="['Status','success','failure']" 
					  			sort-Reverse="true" 
					  			sort-By="sortBy"
					  			sort-By-Header="'Date'"
					  			hide-Headers="true" 
					  			bottom-Headers="false" 
					  			id="deployed"
					  			show-ScrollBars="false"
					  			

					  			>
					  	</cqm-Table>

				</div>
			</div>


		  </div>

		
		  <div id="element4" class="one-col one-row hide" ></div>


		  <div id="element5" class="two-col one-row hide">
			
			

			
		  </div>


		  <div id="element6" class="one-col one-row hide" >
		  	

		  </div>


		  <div id="element7" class="one-col one-row hide" ></div>


		  <div id="element8" class="one-col one-row hide" >


		  		<div class="head_label">
		  			<h2>Total Builds</h2>
		  		</div>

				<div id="builds_build" ng-controller="totalTripleJenkinsController" json-Source = "jenkins/total/build/1">
					<div id="builds_build_today">
						<h2>{{totalToday}}</h2>
						<span class="line"></span>
						<span class="today-label">Today</span>
					</div>

					<div id="builds_build_7">
						<h2>{{total7Days}}</h2>
						<span class="line"></span>
						<span class="d7-label">Last 7 days</span>
					</div>

					<div id="builds_build_14">
						<h2>{{total14Days}}</h2> 
						<span class="line"></span>
						<span class="d14-label">Last 14 days</span>
					</div>

				</div>


		  </div>

		  <div id="element9" class="one-col one-row hide"></div>


		  <div id="element10" class="one-col one-row hide"></div>


		  <div id="element11" class="one-col one-row hide" ></div>
					

		  <div id="element12" class="one-col one-row hide"  ng-controller="singleDataController" json-Source="jira/version/details/1" select-Field="['chooseVersionName','VersionId']"
		  filter-Fields="
		  {
		  		'filter':
		  			[{	'name': 'name',
		  				'value': 'DX-'}]}" ></div>


		  <div id="element13" class="one-col one-row hide" ng-controller="singleDataController" json-Source="jira/version/details/1" select-Field="['chooseVersionName','VersionId']"
		   filter-Fields="
		  {
		  		'filter':
		  			[{	'name': 'name',
		  				'value': 'DX-'}]}" ></div>



		  <div id="element14" class="one-col one-row hide" ng-controller="singleDataController" json-Source="sonar/resources/8" select-Field="['chooseResourceName','resource']"></div>

		

		  <div id="element15" class="one-col one-row hide"></div>
		  
		  


		  <div id="element16" class="one-col one-row hide"><p>15</p></div>
		  <div id="element17" class="one-col one-row hide"><p>16</p></div>
		</div>

<script type="text/javascript">
"use strict";

var two = [];
var three = [];
var four  = [];



$(document).ready(function() {

	$.each($(".two-row"), function(a,b) { 
		two.push( parseInt($(b).attr("id").replace("element","") )); 
	});

	$.each($(".three-row"), function(a,b) { 
		three.push( parseInt($(b).attr("id").replace("element","") )); 
	});

	$.each($(".four-row"), function(a,b) { 
		four.push( parseInt($(b).attr("id").replace("element","") )); 
	});


	function calibrate(_array, _class) {
	for (var i = 0; i < _array.length; i++) {
			var top = $("#element" + _array[i]).position().top;
			$.each($("#wrapper").children(), function(a,b) {
				if ($(b).position().top == top) 
					$(b).addClass(_class);
			});
		}
	}

	function metro() {
	$.each($("#wrapper").children(), function(a,b) {
			var posElement = parseInt($(b).attr("id").replace("element", ""));
			if (two.indexOf(posElement) == -1 && three.indexOf(posElement) == -1 && four.indexOf(posElement) == -1) {
			//if (one.indexOf(posElement) != -1) {
				$(b).removeClass("two-row");
				$(b).removeClass("three-row");
				$(b).removeClass("four-row");
				$(b).addClass("one-row");

			}
		});

		calibrate(two, "two-row");
		calibrate(three, "three-row");
		calibrate(four, "four-row");
	}


	metro();

	$(window).resize(function() {
		metro();
	});
	

});


</script>



<script>


function get(url, callback) {
  var xhttp = new XMLHttpRequest();
      xhttp.onreadystatechange = function() {
        if (xhttp.readyState == 4 && xhttp.status == 200) {
        	// console.log(identifier+" -- "+xhttp.readyState+"svgerror"+xhttp.status);
          var response =  xhttp.responseText;

          if (response != undefined) {
            var data = JSON.parse(response);
            callback(data);

          }
        }
        else
        {
        	// console.log(identifier+" -- "+xhttp.readyState+"svgerror"+xhttp.status);
        }
      };

      xhttp.open("GET", url, true);
      xhttp.send();
}




function getLastReleases(projectId, environment, limit, identifier, callback) {

  // var url = "http://10.33.20.14:8055/api/environment/deployment/" + projectId + "/" + environment + "/" + limit;
  // var url = "http://10.33.20.14:8055/api/environment/chart/deployment/8/DEV/15";
  var url = "http://10.33.20.14:8055/api/environment/chart/deployment/" + projectId + "/" + environment + "/" + limit;
  get(url,function(_d) {
    callback(identifier, _d);
  });

  
}



var createGraph = function(identifier, _data) {

  this.data = _data[0]["data"];

	  // gridlines in x axis function
  this.make_x_gridlines = function() {   
      return d3.axisBottom(x).ticks(5)
  }


  // gridlines in y axis function
  this.make_y_gridlines = function() {   
      return d3.axisLeft(y).ticks(5)
  };

    // set the dimensions and margins of the graph
  var margin = {top: 40, right: 50, bottom: 50, left: 100},
      width = 960 - margin.left - margin.right,
      height = 640 - margin.top - margin.bottom;

  // parse the Jenkins_Job_Start_Time / time
  var parseTime = d3.timeParse("%d-%b-%y");

  // var parseTime = d3.timeFormat('%d:%m');

  // set the ranges
  var x = d3.scaleTime().rangeRound([0, width]);
  var y = d3.scaleLinear().range([height, 0]);

  // var x = d3.scaleBand().range([0, width]).padding(0.1);

  // define the line
  var valueline = d3.line()
      .x(function(d) {console.log(d.x);  return x(d.x); })
      .y(function(d) { return y(d.y); });

  // append the svg obgect to the body of the page
  // appends a 'group' element to 'svg'
  // moves the 'group' element to the top left margin
  var svg = d3.select(identifier)
    .attr("width", width + margin.left + margin.right)
      .style("background-color", "#2f2f2f")
      .attr("height", height + margin.top + margin.bottom)
      .style("border", "1px solid #c2c2c4")
    .append("g")
      .attr("transform",
            "translate(" + margin.left + "," + margin.top + ")");


   var xGridLines = svg.append("g")      
      .attr("class", "grid")
      .attr("transform", "translate(0," + height + ")")
      .call(this.make_x_gridlines()
          .tickSize(-height)
          .tickFormat("")
      );


   // add the Y gridlines
  var yGridLines = svg.append("g")     
      .attr("class", "grid")
      .call(this.make_y_gridlines()
          .tickSize(-width)
          .tickFormat("")
      );


  yGridLines.selectAll("line")
    .style("stroke-width", "1px")
    .style("stroke", "gray");

  xGridLines.selectAll("line")
    .style("stroke-width", "1px")
    .style("stroke", "gray");

  var circleWidth = 15;
  var rectWidth = circleWidth * 0.9;
  var greenBar = "#69876c";
  var redBar = "#a16865";
  var smallCircleWidth = circleWidth / 2;

  

  this.data = this.data.filter(function(d) {
  	// return d.y <= 60 * 1000;
  	return d.y;
  });




    // format the data
    this.data.forEach(function(d) {

        // d.x = parseTime(d.x);
        	d.y = +d.y/1000;
    });

    // Scale the range of the data
    x.domain(d3.extent(this.data, function(d) { return d.x; }));
    y.domain([0, d3.max(this.data, function(d) { return d.y; })]);

    // Add the valueline path.
    /*svg.append("path")
        .data([data])
        .attr("class", "line")
        .attr("d", valueline);*/

    

        
    // Add the scatterplot
    var dot = svg.selectAll("dot")
        .data(this.data)
      .enter()
      .append("g").attr("class", "dot");


    dot.append("rect")
      .attr("x", function(d) { 
          return x(d.x) - rectWidth/2; 
        })
        .attr("y", function(d) { 
          return y(d.y); 
        })
        .attr("width", rectWidth)
        .attr("height", function(d) { 
          return height - y(d.y); 
        })
        .attr('fill', function(d) {
          if (d.status)
            return greenBar;

          return redBar;
        });


    dot.append("circle")
      .attr("r", circleWidth)
      .attr("cx", function(d) { return x(d.x); })
      .attr("cy", function(d) { return y(d.y); })
      .attr('fill', function(d) {
          if (d.status)
            return greenBar;

          return redBar;
        });

    dot.append("circle")
      .attr("r", smallCircleWidth)
      .attr("cx", function(d) { return x(d.x); })
      .attr("cy", function(d) { return y(d.y); })
      .attr("fill", "black");


    // Add the X Axis
    var xGroup = svg.append("g")
        .attr("transform", "translate(0," + height + ")")
        .attr("fill", "gray")
        .call(
            d3.axisBottom(x).tickFormat(d3.timeFormat("%b %e"))
          );


    // Add the Y Axis
    var yGroup = svg.append("g")
        .call(
            d3.axisLeft(y).tickFormat(function(d) { return d + " sec"})
            );

    // xGroup.attr("transform", "translate(-10,0)");

    xGroup.selectAll("path")
      .attr("stroke-width", "1px")
      .attr("stroke", "gray");

    xGroup.selectAll("text")
      .attr("fill", "#c2c2c4")
      .style("font-size", "18px")
      ;

    xGroup.selectAll("line")
      .attr("stroke", "#c2c2c4");

    // xGroup.select("text")

    yGroup.selectAll("path")
      .attr("stroke-width", "1px")
      .attr("stroke", "gray");


    yGroup.selectAll("text")
      .attr("fill", "#c2c2c4")
      .style("font-size", "18px");

    yGroup.selectAll("line")
      .attr("stroke", "#c2c2c4");

      console.log("end of "+identifier);
}




getLastReleases(11, "DEV", 5, "#svg1", function (identifier, data) { createGraph(identifier, data); });
getLastReleases(11, "TEST", 5, "#svg2", function (identifier, data) {  createGraph(identifier, data) });
getLastReleases(11, "STAGE", 5, "#svg3", function (identifier, data) {  createGraph(identifier, data) });




</script>


	<body>

</html>
